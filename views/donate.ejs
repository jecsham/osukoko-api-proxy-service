<script src="https://www.paypalobjects.com/api/checkout.js"></script>
<% include header.ejs %>

    <div class="custom-header py-3 pt-md-5 pb-md-4 mx-auto">
        <h1>Donate</h1>
        <form>
            <div class="form-group" id="lbosuname">
                <label for="osuname">Your osu! username:</label>
                <br>
                <input type="text" id="osuname" class="input" placeholder="Enter osuname">
            </div>
            <div class="form-group" id="lbmessage">
                <label for="lbmessage">A message:</label>
                <br>
                <textarea id="message" class="input" placeholder="If you want :p" cols="22" rows="5"></textarea>
            </div>
            <div class="form-group">
                <label for="amount">Amount:</label>
                <br>
                <input type="number" id="amount" class="input" placeholder="0.00">
            </div>
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="anom-check" onclick="enableDisable()">
                <label class="form-check-label" for="anom-check">Anonymous</label>
            </div>
            <br>
            <div id="paypal-button"></div>
        </form>
    </div>
    <script>
        //FORM
        var amount = document.getElementById("amount").value;
        var inputCheck = document.getElementById("anom-check");
        var lbosuname = document.getElementById("lbosuname");
        var lbmessage = document.getElementById("lbmessage");
        var osuname = lbosuname.value;
        var msg = lbmessage.value;
        function enableDisable() {
            if (!inputCheck.checked == true) {
                lbosuname.style.display = "block";
                lbmessage.style.display = "block";
            } else {
                lbosuname.style.display = "none";
                lbmessage.style.display = "none";
                osuname = "anonymous";
                msg = "anonymous";
            }
        }

        //PAYPAL
        paypal.Button.render({

            env: 'sandbox', // sandbox | production

            // Specify the style of the button

            style: {
                layout: 'vertical',  // horizontal | vertical
                size: 'medium',    // medium | large | responsive
                shape: 'rect',      // pill | rect
                color: 'gold'       // gold | blue | silver | black
            },

            payment: function (data, actions) {
                // 2. Make a request to your server
                return actions.request.post('/my-api/create-payment/')
                    .then(function (res) {
                        // 3. Return res.id from the response
                        return res.id;
                    });
            },
            // Execute the payment:
            // 1. Add an onAuthorize callback
            onAuthorize: function (data, actions) {
                // 2. Make a request to your server
                return actions.request.post('/my-api/execute-payment/', {
                    paymentID: data.paymentID,
                    payerID: data.payerID,
                    osuname: osuname,
                    amount: amount,
                    msg: msg
                })
                    .then(function (res) {
                        // 3. Show the buyer a confirmation message.
                    });
            }


        }, '#paypal-button');

    </script>

    <% include footer.ejs %>